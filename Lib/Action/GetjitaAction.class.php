<?php/** * VeryTalk @版权所有 * @author Jason 2014 *  获取 http://www.jitapu.com爬虫 */class GetjitaAction extends Action{    public $GetJitapuInfo;    public $GetJitapuContent;    public function _initialize() {     set_time_limit(0);     $this->GetJitapuInfo=M("GetJitapuInfo");     $this->GetJitapuContent=M("GetJitapuContent");    }    /**     * 入口     */    public function index(){      set_time_limit(0);      $this->getText();    }    public function getText(){        set_time_limit(0);        $for=array("a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z");        foreach($for as $fk=>$f){        echo  $urlsss="http://www.52jt.net/txt-singer.asp?/$f.html"; echo "&nbsp;&nbsp;";        $html=file_get_contents($urlsss);        preg_match_all("/<div class=\"graya12\" id=\"singer_content\">(.*)<\/div><\/div>/si",$html,$con);        preg_match_all("/<a href=\'(.*?)<\/a>/si",$con[1][0],$cons);         $i=0;        foreach($cons[0] as $key=>$row){             preg_match_all("/<a href=\'(.*?)\' class/si",$row,$nameurl);             preg_match_all("/title=\'(.*?)[\s]/si",$row,$name);             $name=$name[1][0];             $nameurl=$nameurl[1][0];          $listshow=file_get_contents($nameurl);          preg_match_all("/共(.*?)页/si",$listshow,$yeshu);          if($yeshu[1][0]){              $yeshu=$yeshu[1][0];          }else{              $yeshu=2;          }          for($i=0;$i<$yeshu;$i++){              $q=$i+1;             $nameurl=str_replace(".html", "_$q", $nameurl);             $nameurl=$nameurl.".html";          $listshow=file_get_contents($nameurl);          preg_match_all("/<div id=\"gtp_detail\"(.*?)<\/div>/si",$listshow,$listurlshow);           foreach($listurlshow[1] as $kkkkk => $rrrr){               preg_match_all("/<a href=\"(.*?)\" class=(.*?)\">(.*?)<\/a>/si",$rrrr,$url);               foreach($url[1] as $kkk=>$rrr){                   $urls=$rrr;                   echo $title=$url[3][$kkk];                   $this->GetJitapuContent($urls,$title,$name);                   echo $title."&nbsp;".$name."</br>";                   flush();                   ob_flush();               }           }        }      }      exit;     }     }    /**     * 获取详情     * @param string $URL     * @param string $title     * @param string $name     */    public function getJitapuContent($URL='',$title='',$name=''){        set_time_limit(0);        header("Content-Type: text/html; charset=UTF-8");        //得到网页内容        $html=file_get_contents($URL);        preg_match_all("/<pre>(.*)<\/pre>/si",$html,$con);        $html=$con[1][0];        $html=preg_replace("/[-]/", "=",$html);         $this->setJitapuContent($title,$URL,$html,$name,4);    }        /**     * 储存获取到的谱子     * @param unknown $title     * @param unknown $titleurl     * @param unknown $content     * @param string $cid     */    public function setJitapuContent($title,$titleurl,$content,$name,$cid='1'){        set_time_limit(0);            $time=time();            $data=array(                'title'=>$title,                'titleurl'=>$titleurl,                'cid'=>$cid,                'name'=>$name,                'status'=>1            );                $data['content']=$content;                $data['updatetime']=$time;                $this->GetJitapuContent->add($data);           // }    }   }?>